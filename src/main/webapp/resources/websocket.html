<html>
<head>
    <title>用户权限统一管理系统</title>
    <script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
</head>
<body>
    <input id="url" style="width: 800px"><button onclick="opensocket()">链接</button><button onclick="closesocket()">断开</button>
    <button onclick="getstatus()">链接状态</button><label id="socketstatus"></label>
    <br/>
    <input id="to" placeholder="发送人" style="width: 800px"><br>
    <input id="title" placeholder="标题" style="width: 800px"><br>
    <textarea id="msg" placeholder="发送的内容" rows="10" style="width: 800px"></textarea>
    <button onclick="sendsocket()">发送</button>
    <div id="mymsg"></div>
</body>
</html>
<script>
    var socket;
    function opensocket() {
        socket = new WebSocket($("#url").val());
        socket.onopen = function(event) {
            getstatus();
        };
        socket.onmessage = function (event) {
            var msgData = $.parseJSON(event.data);
            $("#mymsg").append(msgData.from+":"+msgData.title+"------>"+msgData.msg+"<br/>");
        }
    }
    function sendsocket() {
        var json = {
            "to":$("#to").val(),
            "msg":$("#msg").val(),
            "title":$("#title").val()
        }
        socket.send(JSON.stringify(json));
    }
    function getstatus() {
        $("#socketstatus").html(socket.readyState);
    }
    function closesocket() {
        socket.close()
        getstatus();
    }
</script>